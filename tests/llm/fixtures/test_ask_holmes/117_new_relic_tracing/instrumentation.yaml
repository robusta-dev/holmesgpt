apiVersion: newrelic.com/v1alpha2
kind: Instrumentation
metadata:
  name: nr-node
  namespace: newrelic
spec:
  agent:
    language: nodejs
    image: newrelic/newrelic-node-init:latest
    env:
      - name: NEW_RELIC_APP_NAME
        valueFrom:
          fieldRef:
            fieldPath: metadata.labels['app.kubernetes.io/name']
      - name: NEW_RELIC_DISTRIBUTED_TRACING_ENABLED
        value: "true"
  namespaceLabelSelector:
    matchExpressions:
      - key: "kubernetes.io/metadata.name"
        operator: "In"
        values: ["trace-demo"]
---
apiVersion: newrelic.com/v1alpha2
kind: Instrumentation
metadata:
  name: nr-python
  namespace: newrelic
spec:
  agent:
    language: python
    image: newrelic/newrelic-python-init:latest
    env:
      - name: NEW_RELIC_APP_NAME
        valueFrom:
          fieldRef:
            fieldPath: metadata.labels['app.kubernetes.io/name']
      - name: NEW_RELIC_DISTRIBUTED_TRACING_ENABLED
        value: "true"
  namespaceLabelSelector:
    matchExpressions:
      - key: "kubernetes.io/metadata.name"
        operator: "In"
        values: ["trace-demo"]
