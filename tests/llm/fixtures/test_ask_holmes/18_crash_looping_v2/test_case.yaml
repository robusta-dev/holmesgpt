user_prompt: "What is the issue with golden-eagle?"
expected_output:
  - The `golden-eagle` pod experienced an expired SSL certificate.
before_test: |
  # Create dummy certificate data (base64 encoded)
  DUMMY_CERT=$(echo -n "dummy-certificate-content" | base64)
  DUMMY_KEY=$(echo -n "dummy-private-key-content" | base64)

  # Apply the manifest first (which creates the namespace)
  kubectl apply -f manifest.yaml

  # Create the certificate Secret in the namespace
  kubectl create secret generic db-certs-config \
    --from-literal=certificate.pem="$DUMMY_CERT" \
    --from-literal=key.pem="$DUMMY_KEY" \
    -n app-18

  # Wait for the SSL certificate error
  timeout=60
  elapsed=0
  while [ $elapsed -lt $timeout ]; do
    if kubectl logs -l app=flask -n app-18 2>/dev/null | grep -q "ERROR - SSL certificate expired"; then
      echo "SSL certificate error detected"
      break
    fi
    sleep 2
    elapsed=$((elapsed + 2))
  done
  if [ $elapsed -ge $timeout ]; then
    echo "Timeout waiting for SSL certificate error"
    exit 1
  fi
after_test: |
  kubectl delete namespace app-18
tags:
  - easy
  - kubernetes
