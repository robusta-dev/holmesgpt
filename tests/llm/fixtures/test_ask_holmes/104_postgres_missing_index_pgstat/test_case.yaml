user_prompt: "The user-lookup service in namespace-104 is experiencing slow response times. What's causing the performance issue?"
expected_output:
  - Database queries are slow due to missing index on users.email column
  - Sequential scans are occurring on the users table with 100k rows
  - Each email lookup query is taking over 100ms due to full table scan
  - CREATE INDEX ON users(email) would resolve the performance issue
tags:
  - hard
  - database
description: |
  This eval simulates a common database performance issue - missing index on a frequently queried column.

  Setup:
  - PostgreSQL database with pg_stat_statements extension enabled
  - Users table with 100k records but no index on email column
  - API service performing email lookups: SELECT * FROM users WHERE email = ?
  - Each query results in a sequential scan of all 100k rows

  Expected troubleshooting steps:
  1. Check pod logs to see if queries are slow
  2. Connect to PostgreSQL: kubectl exec -it postgres-pod -- psql -U postgres
  3. Query pg_stat_statements: SELECT query, mean_time, calls FROM pg_stat_statements ORDER BY mean_time DESC
  4. Identify slow query with high mean_time
  5. Run EXPLAIN ANALYZE on the query to see Sequential Scan
  6. Check table structure: \d users (shows no index on email)
  7. Conclude that missing index on email column is causing full table scans

  The issue becomes obvious when you see Seq Scan on 100k rows in EXPLAIN output.
before_test: |
  kubectl create namespace namespace-104
  kubectl apply -f ./manifest.yaml -n namespace-104
  kubectl wait --for=condition=ready pod -l app=postgres -n namespace-104 --timeout=60s
  kubectl wait --for=condition=ready pod -l app=user-lookup -n namespace-104 --timeout=60s
  sleep 30  # Let some slow queries accumulate
after_test: |
  kubectl delete -f ./manifest.yaml -n namespace-104
  kubectl delete namespace namespace-104
