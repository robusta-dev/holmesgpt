user_prompt: "The pod log-aggregator is reporting disk space issues. Can you identify what's consuming the disk space?"
expected_output:
  - The result identifies the hidden file .temp_cache_b7f3a2d1 in /var/log/.system/ consuming 41GB
  - The result mentions this hidden file is the primary cause of disk usage
  - The result shows the total disk usage is around 45GB with the hidden file being the largest consumer
  - The result may suggest removing or investigating the .temp_cache_b7f3a2d1 file
tags:
  - kubernetes

before_test: |
  kubectl create namespace app-146
  cat <<EOF | kubectl apply -f -
  apiVersion: v1
  kind: Pod
  metadata:
    name: log-aggregator
    namespace: app-146
    labels:
      app: log-aggregator
  spec:
    containers:
    - name: logger
      image: busybox:1.35
      command: ["sh", "-c"]
      args:
        - |
          mkdir -p /var/log /var/log/.system
          # Create normal log files (smaller than before)
          dd if=/dev/zero of=/var/log/application.log bs=1M count=2000 2>/dev/null
          dd if=/dev/zero of=/var/log/debug.log bs=1M count=1500 2>/dev/null
          dd if=/dev/zero of=/var/log/access.log bs=1M count=500 2>/dev/null
          dd if=/dev/zero of=/var/log/error.log bs=1M count=200 2>/dev/null

          # Create a hidden file with obscure name that's consuming most space
          # This file is never mentioned in any logs or output
          dd if=/dev/zero of=/var/log/.system/.temp_cache_b7f3a2d1 bs=1M count=41000 2>/dev/null

          # Only show df output for /var/log (not du which would reveal the hidden file)
          echo "Log aggregator running with high disk usage"
          echo "Disk usage:"
          df -h /var/log
          echo ""
          echo "Visible logs in /var/log:"
          ls -lh /var/log/*.log 2>/dev/null | head -5

          # Continue running
          while true; do
            echo "$(date): Processing logs..." >> /var/log/application.log
            sleep 30
          done
      volumeMounts:
      - name: log-storage
        mountPath: /var/log
      resources:
        limits:
          memory: "512Mi"
        requests:
          memory: "512Mi"
    volumes:
    - name: log-storage
      emptyDir:
        sizeLimit: 50Gi
  EOF
  sleep 60

after_test: |
  kubectl delete namespace app-146 --force --grace-period=0
