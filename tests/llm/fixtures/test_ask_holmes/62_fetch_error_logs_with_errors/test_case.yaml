user_prompt: "post last 10 logs that contain \"ERROR\" from payment-service in production-62 namespace"
expected_output: |
  The following logs are shown either directly or in summarized form:
    ERROR: Database connection failed: ETIMEDOUT
    ERROR: Attempting reconnection (attempt 1/3)
    ERROR: Connection retry failed (attempt 2/3)
    ERROR: Maximum retry attempts exceeded
    ERROR: Backup connection failed: ECONNREFUSED
    ERROR: Unable to establish database connection

  The following log is NOT shown:
    INFO: Application starting up
    WARN: Database connection slow

  The following log MAY be shown (it does not impact the correctness of the test):
    FATAL: Shutting down application

before_test: |
  kubectl create namespace production-62 || true
  kubectl create secret generic payment-service-logs-script \
  --from-file=generate_logs.py=./generate_logs.py \
  -n production-62 --dry-run=client -o yaml | kubectl apply -f -
  kubectl apply -f ./manifest.yaml
  kubectl wait --for=condition=available deployment/payment-service -n production-62 --timeout=90s
  sleep 60
after_test: |
  kubectl delete -f ./manifest.yaml
  kubectl delete secret payment-service-logs-script -n production-62 --ignore-not-found
  kubectl delete namespace production-62 --ignore-not-found

tags:
  - logs
  - medium
