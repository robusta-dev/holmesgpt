apiVersion: v1
kind: Pod
metadata:
  name: order-service
  namespace: app-145
  labels:
    app: order-service
spec:
  containers:
  - name: java-app
    image: openjdk:11
    command: ["sh", "-c"]
    args:
      - |
        # Copy Java source from secret
        cp /app/OrderService.java .

        # Compile and run with JVM flags
        javac OrderService.java

        # Run with heap size and GC logging (Java 11+ compatible)
        java -Xmx1g -Xms512m \
             -XX:+UseG1GC \
             -Xlog:gc*:file=/tmp/gc.log:time \
             -XX:+HeapDumpOnOutOfMemoryError \
             -XX:HeapDumpPath=/tmp \
             OrderService
    volumeMounts:
    - name: app-source
      mountPath: /app
    resources:
      limits:
        memory: "1Gi"
        cpu: "500m"
      requests:
        memory: "1Gi"
        cpu: "200m"
  volumes:
  - name: app-source
    secret:
      secretName: order-service-source
      defaultMode: 0644
