checks:
  - name: "Deployment Ready"
    description: "Check if deployment has ready replicas"
    query: "Does the deployment 'test-app' in namespace 'app-03' have at least 2 ready replicas?"
    tags: ["kubernetes", "deployment"]
    repeat: 1
    failure_threshold: 0

  - name: "Service Exists"
    description: "Check if service exists"
    query: "Is there a service named 'test-app-service' in namespace 'app-03'?"
    tags: ["kubernetes", "service"]
    repeat: 1
    failure_threshold: 0

  - name: "No Pod Errors"
    description: "Check for pod errors"
    query: "Are there any pods in namespace 'app-03' that are in Error or CrashLoopBackOff state?"
    tags: ["kubernetes", "errors"]
    repeat: 1
    failure_threshold: 0

expected_results:
  "Deployment Ready": "pass"
  "Service Exists": "pass"
  "No Pod Errors": "pass"

expected_output: "All checks passed"

before_test: |
  kubectl create namespace app-03 --dry-run=client -o yaml | kubectl apply -f -
  kubectl apply -f manifests.yaml
  kubectl wait --for=condition=Available deployment/test-app -n app-03 --timeout=60s

after_test: |
  kubectl delete -f manifests.yaml --ignore-not-found=true
  kubectl delete namespace app-03 --ignore-not-found=true

tags:
  - kubernetes
  - easy

description: "Test multiple checks running together"
