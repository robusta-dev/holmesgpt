# InfraInsights Instance-Based Routing Instructions

## ğŸ¯ **Toolset Routing Priority**

When the user mentions **specific instance names**, **environments**, or **managed infrastructure**, always prioritize **InfraInsights toolsets** over generic/built-in ones.

### **ğŸ” Instance Name Patterns That Trigger InfraInsights:**
- **Named instances**: `dock-atlantic-staging`, `production-es`, `kafka-prod`, `redis-cache-1`
- **Environment-specific**: `staging-elasticsearch`, `prod-kafka`, `dev-redis`
- **User possessive**: `my elasticsearch cluster`, `our kafka instance`, `my redis cache`
- **Explicit environments**: `staging`, `production`, `development`, `testing`

### **âš ï¸ When to Use InfraInsights vs Built-in Toolsets:**

#### âœ… **Use InfraInsights Toolsets When:**
- User mentions specific instance names (e.g., `dock-atlantic-staging`)
- User refers to "my" or "our" infrastructure (`my Elasticsearch cluster`)
- Query includes environment references (`staging kafka`, `production redis`)
- User wants to connect to managed instances
- Instance-specific operations (health checks, configuration, data access)

#### âŒ **Use Built-in/Generic Toolsets When:**
- User asks general questions without instance specifics
- Generic monitoring queries (`show all pods`, `cluster resources`)
- Prometheus metrics without instance context
- General troubleshooting without named resources

### **ğŸ”§ Service Type Routing Rules:**

#### **Elasticsearch Queries:**
- âœ… **InfraInsights**: `"dock-atlantic-staging Elasticsearch"`, `"my ES cluster"`, `"production elasticsearch health"`
- âŒ **Prometheus**: `"elasticsearch metrics"`, `"cluster-wide elasticsearch stats"`

### **ğŸ“‹ CRITICAL: Parameter Passing Instructions**

When using InfraInsights toolsets, **ALWAYS extract and pass instance identifiers** from user prompts:

#### **Required Parameter Extraction:**
```python
# Extract these patterns from user prompts and pass to tools:
"instance_name: dock-atlantic-staging" â†’ {"instance_name": "dock-atlantic-staging"}
"cluster_name: production-kafka" â†’ {"cluster_name": "production-kafka"}  
"my elasticsearch cluster" â†’ {"prompt": "my elasticsearch cluster"}
"dock-atlantic-staging Elasticsearch" â†’ {"instance_name": "dock-atlantic-staging", "service_type": "elasticsearch"}
```

#### **Example Tool Calls:**
```
elasticsearch_health_check({"instance_name": "dock-atlantic-staging"})
kafka_list_topics({"cluster_name": "production-kafka"})
mongodb_stats({"instance_name": "mongo-staging"})
```

**âš ï¸ NEVER call InfraInsights tools with empty parameters `{}` when instance names are mentioned in prompts!**

#### **Kafka Queries:**
- âœ… **InfraInsights**: `"kafka-prod topics"`, `"my kafka cluster"`, `"staging kafka consumers"`
- âŒ **Built-in**: `"kafka cluster overview"`, `"all kafka metrics"`

#### **MongoDB Queries:**
- âœ… **InfraInsights**: `"mongo-staging databases"`, `"my mongodb instance"`, `"production mongo stats"`
- âŒ **Generic**: `"mongodb pod status"`, `"mongo container logs"`

#### **Redis Queries:**
- âœ… **InfraInsights**: `"redis-cache-1 keys"`, `"my redis cluster"`, `"staging redis memory"`
- âŒ **Built-in**: `"redis pod logs"`, `"redis container status"`

#### **Kubernetes Queries:**
- âœ… **InfraInsights**: `"k8s-prod cluster"`, `"my kubernetes instance"`, `"staging k8s nodes"`
- âŒ **Core**: `"all pods"`, `"cluster resources"`, `"namespace overview"`

### **ğŸš¨ Error Resolution Patterns:**

If you encounter these patterns, **immediately switch to InfraInsights**:
- `"Instance X not found"` â†’ User likely refers to an InfraInsights-managed instance
- Prometheus tools return empty results for named instances
- Generic tools fail to find specific instance names

### **ğŸ“ Logging Recognition:**

Look for these log patterns to confirm InfraInsights toolset usage:
- âœ… `ğŸ” INFRAINSIGHTS: Attempting to resolve instance...`
- âœ… `âœ… INFRAINSIGHTS: Successfully resolved instance: dock-atlantic-staging`
- âŒ `INFO Running tool execute_prometheus_instant_query` (wrong toolset)

### **ğŸ¯ Quick Decision Matrix:**

| User Query Contains | Toolset Choice | Example |
|-------------------|---------------|---------|
| Specific instance name | âœ… InfraInsights | `dock-atlantic-staging` |
| "my/our" + service | âœ… InfraInsights | `my elasticsearch cluster` |
| Environment + service | âœ… InfraInsights | `staging kafka` |
| Generic service name | âŒ Built-in | `elasticsearch health` |
| Pod/container focus | âŒ Kubernetes Core | `elasticsearch pods` |
| Metrics-only query | âŒ Prometheus | `elasticsearch_cluster_health` |

### **ğŸ”„ Fallback Strategy:**

1. **First attempt**: Use InfraInsights toolset for named instances
2. **If InfraInsights fails**: Check error message
3. **If "instance not found"**: Suggest creating the instance in InfraInsights
4. **If other error**: Provide troubleshooting steps
5. **Never fallback** to generic toolsets for named instances without explaining why

### **ğŸ’¡ Example Routing Decisions:**

```
âŒ Wrong: "Check elasticsearch health" â†’ Prometheus toolset
âœ… Right: "Check dock-atlantic-staging elasticsearch health" â†’ InfraInsights toolset

âŒ Wrong: "List kafka topics" â†’ Built-in Kafka toolset  
âœ… Right: "List topics in my kafka cluster" â†’ InfraInsights toolset

âŒ Wrong: "Show redis memory" â†’ Generic Redis tools
âœ… Right: "Show redis-cache-1 memory usage" â†’ InfraInsights toolset
```

## ğŸ¯ **Remember: Named instances = InfraInsights. Generic queries = Built-in toolsets.** 